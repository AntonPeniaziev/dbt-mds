from io import BytesIO, StringIO
from typing import List

import requests
import json
from requests.adapters import HTTPAdapter
from urllib3 import Retry
import pyarrow as pa
import pandas as pd
import boto3


def dataframe_to_s3(s3_client, input_datafame, bucket_name, filepath, format):
    if format == 'parquet':
        out_buffer = BytesIO()
        input_datafame.to_parquet(out_buffer, index=False)

    elif format == 'csv':
        out_buffer = StringIO()
        input_datafame.to_parquet(out_buffer, index=False)

    s3_client.put_object(Bucket=bucket_name, Key=filepath, Body=out_buffer.getvalue())

def write_data_to_s3(df, bucket, key):

    session = boto3.session.Session()

    s3_client = session.client(
        service_name='s3',
        aws_access_key_id='test',
        aws_secret_access_key='test',
        endpoint_url='http://localhost:4566',
    )
    dataframe_to_s3(s3_client, df, bucket, key, 'parquet')
    # s3_client.put_object(Body=data, Bucket=bucket, Key=key)

class ImdbApi:
    def __init__(self):
        self.token = "k_kebxggjy"
        self.base_url = "https://imdb-api.com/API/"

    def _dicts_to_row_json(self, list_of_dicts: List[dict]):
        return '\n'.join([json.dumps(r) for r in list_of_dicts])

    def _send_http_request_with_retry(self, route, method='GET', headers=None, data=None, params=None, retry_count=2,
                                      backoff_factor=0.5):
        session = requests.Session()
        retries = Retry(total=retry_count, backoff_factor=backoff_factor)
        adapter = HTTPAdapter(max_retries=retries)

        session.mount('https://', adapter)

        response = session.request(method, self.base_url + route, headers=headers, json=data, params=params)

        response.raise_for_status()

        return response.json()

    def _select_fields(self, target_dict, selected_fields: List[str]):
        return {k: target_dict[k] for k in selected_fields if k in target_dict}

    def _advanced_search(self, title_type, user_rating, release_date, num_votes, count,
                         selected_fields: List[str] = ['id', 'title', 'description', 'imDbRating',
                                                       'imDbRatingVotes', 'stars', 'genres']):
        url = f"AdvancedSearch/{self.token}?" \
              f"title_type={title_type}&user_rating={user_rating}&" \
              f"release_date={release_date}&" \
              f"num_votes>{num_votes}&count={count}"

        response_json = self._send_http_request_with_retry(url)

        return [self._select_fields(r, selected_fields) for r in response_json['results']]

    def _get_full_cast_for_id(self, id):
        # response_json = self._send_http_request_with_retry(f"FullCast/{self.token}/{id}")
        response_json = {'imDbId': 'tt1292594', 'title': 'Front of the Class', 'fullTitle': 'Front of the Class (2008)', 'type': 'Movie', 'year': '2008', 'directors': {'job': 'Director', 'items': [{'id': 'nm0921464', 'name': 'Peter Werner', 'description': ''}]}, 'writers': {'job': 'Writer', 'items': [{'id': 'nm0725564', 'name': 'Thomas Rickman', 'description': '(written by) (as Tom Rickman)'}, {'id': 'nm3222550', 'name': 'Brad Cohen', 'description': '(book) and'}, {'id': 'nm3222441', 'name': 'Lisa Wysocky', 'description': '(book)'}]}, 'actors': [{'id': 'nm2312345', 'image': 'https://m.media-amazon.com/images/M/MV5BODc2OTUwMjM5Ml5BMl5BanBnXkFtZTgwNjg2MjAwMDE@._V1_Ratio0.7273_AL_.jpg', 'name': 'James Wolk', 'asCharacter': 'Brad Cohen (as Jimmy Wolk)'}, {'id': 'nm0001852', 'image': 'https://m.media-amazon.com/images/M/MV5BMTg0MzcwOTkzNV5BMl5BanBnXkFtZTcwMDc3NTA3MQ@@._V1_Ratio0.7727_AL_.jpg', 'name': 'Treat Williams', 'asCharacter': 'Norman Cohen'}, {'id': 'nm1122614', 'image': 'https://m.media-amazon.com/images/M/MV5BZDk3ZGZhYmQtNTY4Mi00ODkxLTg5YWMtOGE5YzE2MDRmZmYxXkEyXkFqcGdeQXVyMjkyNTUwOA@@._V1_Ratio1.5000_AL_.jpg', 'name': 'Dominic Scott Kay', 'asCharacter': 'Young Brad Cohen'}, {'id': 'nm0237711', 'image': 'https://m.media-amazon.com/images/M/MV5BYzZiNDI2ZjktNzM3YS00ZjgxLWFhYTctYzNiYWNlOGQ4ODdmXkEyXkFqcGdeQXVyMTI2MTg1MjAz._V1_Ratio0.8182_AL_.jpg', 'name': 'Sarah Drew', 'asCharacter': 'Nancy Lazarus'}, {'id': 'nm0948723', 'image': 'https://m.media-amazon.com/images/M/MV5BODA1NzkyMTU3NV5BMl5BanBnXkFtZTgwODc2OTQ4MTE@._V1_Ratio0.7727_AL_.jpg', 'name': 'Kathleen York', 'asCharacter': 'Diane'}, {'id': 'nm0159609', 'image': 'https://m.media-amazon.com/images/M/MV5BZjY4NTJlNjktMWQzNy00NDVhLWJkOGUtNWZmNWUxMzEzYTdmXkEyXkFqcGdeQXVyMjIxNzUxMjY@._V1_Ratio0.7273_AL_.jpg', 'name': 'Joe Chrest', 'asCharacter': 'Jim Ovbey'}, {'id': 'nm0005004', 'image': 'https://m.media-amazon.com/images/M/MV5BMTQyMzI5MDE5N15BMl5BanBnXkFtZTYwODkxODE0._V1_Ratio0.7273_AL_.jpg', 'name': 'Patricia Heaton', 'asCharacter': 'Ellen Cohen'}, {'id': 'nm1067251', 'image': 'https://m.media-amazon.com/images/M/MV5BNTAxMzYyZDEtZDBhNC00NGYyLWFkNDMtNjQyNjc2ODE3YWNmXkEyXkFqcGdeQXVyMjcyNjIzNg@@._V1_Ratio1.0455_AL_.jpg', 'name': 'Johnny Pacar', 'asCharacter': 'Jeff'}, {'id': 'nm2628285', 'image': 'https://m.media-amazon.com/images/M/MV5BMjA4MTAwNzA4N15BMl5BanBnXkFtZTYwODU0NDI3._V1_Ratio1.3182_AL_.jpg', 'name': 'Charles Henry Wyson', 'asCharacter': 'Young Jeff'}, {'id': 'nm0278096', 'image': 'https://m.media-amazon.com/images/M/MV5BNDkyODY3NDUyOV5BMl5BanBnXkFtZTcwNDEwMjkyMQ@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Charlie Finn', 'asCharacter': 'Ron'}, {'id': 'nm0124894', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Dianne Butler', 'asCharacter': 'Hilarie Straka'}, {'id': 'nm1641231', 'image': 'https://m.media-amazon.com/images/M/MV5BMmM0NjNmOTEtMmVjZS00YzgxLTg4ZmYtYjEzMzQ3N2ZjOTg0XkEyXkFqcGdeQXVyMTMxODQ1NTY@._V1_Ratio0.7273_AL_.jpg', 'name': 'Helen Ingebritsen', 'asCharacter': 'Susan'}, {'id': 'nm0926683', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Laura Whyte', 'asCharacter': 'Brenda'}, {'id': 'nm0687772', 'image': 'https://m.media-amazon.com/images/M/MV5BMWI1NjQyMTMtZGI4Yi00MDg0LWEwYzAtNWYwODU0N2M1ZTMxXkEyXkFqcGdeQXVyNTA3MTgzMw@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Mike Pniewski', 'asCharacter': 'Principal Myer'}, {'id': 'nm2360398', 'image': 'https://m.media-amazon.com/images/M/MV5BYmU1OWEzY2EtNTE5ZC00YWQxLWI2MTgtZGE3MThlN2RiODI4XkEyXkFqcGdeQXVyMTg3OTU2NTY@._V1_Ratio0.7727_AL_.jpg', 'name': 'Michael H. Cole', 'asCharacter': 'Principal Fowler'}, {'id': 'nm3164835', 'image': 'https://m.media-amazon.com/images/M/MV5BNzFhY2I5YzgtOWE1My00OTc3LTkzNTctMTM3NzUyM2NjODVlXkEyXkFqcGdeQXVyMjQwMDg0Ng@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Katherine Shepler', 'asCharacter': 'Heather'}, {'id': 'nm3204360', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Bryce Wilkins', 'asCharacter': 'Gaylon'}, {'id': 'nm3385458', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Zack Miller', 'asCharacter': 'Thomas'}, {'id': 'nm3147385', 'image': 'https://m.media-amazon.com/images/M/MV5BOGYwOTI3ZDUtNDQzYS00MDliLWE2NWUtOTIwNzQ4NmMyNWRiXkEyXkFqcGdeQXVyMTk5NTgzOTY@._V1_Ratio0.7273_AL_.jpg', 'name': 'Anna Rappaport', 'asCharacter': 'Amanda'}, {'id': 'nm2677066', 'image': 'https://m.media-amazon.com/images/M/MV5BNzUyZTBjMzktZTBjNC00NmRmLThhZDktZmEzMDU2ZTUzY2JhXkEyXkFqcGdeQXVyODkyMzk1OQ@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Nicholas Stargel', 'asCharacter': 'Eli'}, {'id': 'nm2264463', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Connor Hill', 'asCharacter': 'Henry'}, {'id': 'nm0079925', 'image': 'https://m.media-amazon.com/images/M/MV5BMTU1NTIyMjAxMV5BMl5BanBnXkFtZTgwOTU2NjQzODE@._V1_Ratio0.7273_AL_.jpg', 'name': 'Karen Beyer', 'asCharacter': 'Mrs. Wilkins'}, {'id': 'nm0480808', 'image': 'https://m.media-amazon.com/images/M/MV5BMTY4NDcwODcyOF5BMl5BanBnXkFtZTgwMjgwNjczNTE@._V1_Ratio0.7273_AL_.jpg', 'name': 'Sandra Ellis Lafferty', 'asCharacter': 'Recruiter (as Sandra Lafferty)'}, {'id': 'nm0249281', 'image': 'https://m.media-amazon.com/images/M/MV5BMTkyNjUwMTI1MV5BMl5BanBnXkFtZTcwOTgxMDIzMQ@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Lori Beth Sikes', 'asCharacter': 'Deborah (as Lori Beth Edgeman)'}, {'id': 'nm0718680', 'image': 'https://m.media-amazon.com/images/M/MV5BMTE1ZTc1OTktOTJiMy00OWJiLTkxYzUtMTllNWQxOWNmYmJlXkEyXkFqcGdeQXVyMjAxNjMzNA@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Ric Reitz', 'asCharacter': "Amanda's Father"}, {'id': 'nm0096303', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Matt Borel', 'asCharacter': 'Test Administrator'}, {'id': 'nm3153028', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Chan Ta Rivers', 'asCharacter': 'Maxine (as Chanta Rivers)'}, {'id': 'nm2054268', 'image': 'https://m.media-amazon.com/images/M/MV5BZDFmYTVlYWMtOWVmZi00ZGE2LTljMGYtOWE5OTRlZTAzYjllXkEyXkFqcGdeQXVyNjAwNzQyOA@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Jenny Shakeshaft', 'asCharacter': 'Lisa (as Jennifer Sipes)'}, {'id': 'nm0414865', 'image': 'https://m.media-amazon.com/images/M/MV5BYTZjZjljZjMtMTkzZi00OGIwLWEyODktMWMwMmM5NzJiMmEwXkEyXkFqcGdeQXVyMjQwMDg0Ng@@._V1_Ratio0.7727_AL_.jpg', 'name': 'Jill Jacobson', 'asCharacter': 'Aged Aunt'}, {'id': 'nm4955327', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Ransom Ashley', 'asCharacter': 'Student'}, {'id': 'nm2591390', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Breanna Brooks', 'asCharacter': 'Molly / Birthday girl'}, {'id': 'nm3261114', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'NyaSimone Caldwell', 'asCharacter': "Molly / Brad's Class"}, {'id': 'nm7764516', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'M Charlotte Cheatham', 'asCharacter': ''}, {'id': 'nm2641594', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Brooke Coleman', 'asCharacter': 'Teacher'}, {'id': 'nm0178385', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Silas Cooper', 'asCharacter': 'Golfer'}, {'id': 'nm0187603', 'image': 'https://m.media-amazon.com/images/M/MV5BMjEyMDk1NTM0N15BMl5BanBnXkFtZTcwMzk4NDUyMQ@@._V1_Ratio0.7727_AL_.jpg', 'name': 'Tommy Cresswell', 'asCharacter': 'Mr. Stivers'}, {'id': 'nm3161484', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Ella Davidson', 'asCharacter': 'Administrator'}, {'id': 'nm4237669', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Tavaris James Durell', 'asCharacter': 'Construction Worker'}, {'id': 'nm2467078', 'image': 'https://m.media-amazon.com/images/M/MV5BMDA1YzVjYTEtZjAxOC00N2U3LWFhNGItYTA5NmU3N2U1NTI1XkEyXkFqcGdeQXVyMTMyMDkzMzU@._V1_Ratio0.7727_AL_.jpg', 'name': 'Ted Ferguson', 'asCharacter': 'Substitute School Teacher'}, {'id': 'nm3586837', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Juanita Harrison', 'asCharacter': 'Banquet Attendee'}, {'id': 'nm1892325', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Halen D. Isbell', 'asCharacter': ''}, {'id': 'nm3109068', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Avery Kelley', 'asCharacter': 'Cameron'}, {'id': 'nm3218666', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Tyler Krieg', 'asCharacter': "Tourette's Son #38"}, {'id': 'nm3218782', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Jayden Mankins', 'asCharacter': 'Tatum'}, {'id': 'nm8654082', 'image': 'https://m.media-amazon.com/images/M/MV5BYzk1MzYzNTAtNDIzNy00ZDhjLWFiMjYtNTk1ZWFiMzE0ZTZiXkEyXkFqcGdeQXVyMTE2MzUyMTA4._V1_Ratio0.7727_AL_.jpg', 'name': 'Desiree Page', 'asCharacter': 'Student'}, {'id': 'nm1296340', 'image': 'https://m.media-amazon.com/images/M/MV5BZDdmMDQ2OWUtYTc4Ny00ZjdhLTlhZjctNjI5NWM3NmRhYmQ5XkEyXkFqcGdeQXVyMjQwMDg0Ng@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Terry Dale Parks', 'asCharacter': 'Golfer (as Terry Parks)'}, {'id': 'nm4472415', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'James Paul', 'asCharacter': 'Picnic Patron'}, {'id': 'nm2831141', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Jeannie Perrin', 'asCharacter': 'Teacher'}, {'id': 'nm3237481', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Shelby Purchner', 'asCharacter': 'Grammar Student'}, {'id': 'nm12896193', 'image': 'https://m.media-amazon.com/images/M/MV5BNWJhNWM4N2YtYWJmYi00YmJjLWExN2QtZDNlM2NiMDgxYzYyXkEyXkFqcGdeQXVyMTIyNjI3NzIx._V1_Ratio0.7273_AL_.jpg', 'name': 'Krystyn Ryder', 'asCharacter': 'Student'}, {'id': 'nm0821436', 'image': 'https://m.media-amazon.com/images/M/MV5BMDU1MzRmNWMtZGY0NS00OTE1LTlhNDktNzQzYmMyNzFmZDU5XkEyXkFqcGdeQXVyMjQwMDg0Ng@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Andy Stahl', 'asCharacter': 'first Principal'}, {'id': 'nm3769920', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Marchello Stewart', 'asCharacter': 'Actor College Students'}, {'id': 'nm4740539', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Jeffrey Stirl', 'asCharacter': 'Bar Patron'}, {'id': 'nm0840285', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Carol Sutton', 'asCharacter': 'Admission Clerk'}, {'id': 'nm2772185', 'image': 'https://m.media-amazon.com/images/M/MV5BNjQ4NDVkMWMtOTUyNC00NThiLWFjMzQtYjY1NTAzZWUzYjZjXkEyXkFqcGdeQXVyMTEzMDc5MTA@._V1_Ratio0.7273_AL_.jpg', 'name': 'Lanie Taylor', 'asCharacter': 'Simone'}, {'id': 'nm3644821', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'David Lee Valle', 'asCharacter': 'Bar Patron'}, {'id': 'nm2397206', 'image': 'https://m.media-amazon.com/images/M/MV5BMTVlMGE5YmItNzU5Yi00MGFjLWE5NWEtNzZkMWE2OTNiMzU2XkEyXkFqcGdeQXVyNjY1ODIzNjA@._V1_Ratio0.7273_AL_.jpg', 'name': 'Jake Austin Walker', 'asCharacter': "Young Brad's Bully"}, {'id': 'nm3110746', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Scott Yarnell', 'asCharacter': 'Teacher'}, {'id': 'nm1874504', 'image': 'https://m.media-amazon.com/images/M/MV5BOTE1ODk0NzAxN15BMl5BanBnXkFtZTcwOTUzNTczMQ@@._V1_Ratio0.7727_AL_.jpg', 'name': 'Mark Adam', 'asCharacter': 'Mike - Golfer (uncredited)'}, {'id': 'nm3400248', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Ryan Akin', 'asCharacter': 'Bully #1 (uncredited)'}, {'id': 'nm0093135', 'image': 'https://m.media-amazon.com/images/M/MV5BMTU3NTQ3OTU2OF5BMl5BanBnXkFtZTcwNjcyMjQ2Nw@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Angie Bolling', 'asCharacter': 'Second Principal (uncredited)'}, {'id': 'nm2720564', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Bruce Bryant', 'asCharacter': 'Annoyed Bar Patron (uncredited)'}, {'id': 'nm2732159', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Michael Byrnes', 'asCharacter': "Heather's Father (uncredited)"}, {'id': 'nm2326027', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Renee Caldwell', 'asCharacter': 'Teacher (uncredited)'}, {'id': 'nm3160743', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Cole Cordell', 'asCharacter': 'Bully #3 (uncredited)'}, {'id': 'nm2468237', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Kip Cummings', 'asCharacter': 'Party Attendant (uncredited)'}, {'id': 'nm3271029', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Jon Dainty', 'asCharacter': 'Construction Worker (uncredited)'}, {'id': 'nm0272393', 'image': 'https://m.media-amazon.com/images/M/MV5BZGQ4ZGE1YmYtNWRiMi00MmE4LThhNTctNzQ4MDkzOTJhNzI5XkEyXkFqcGdeQXVyNjMxODk4NQ@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Chamblee Ferguson', 'asCharacter': 'First Principal (uncredited)'}, {'id': 'nm3180150', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Kerrigan Hightower', 'asCharacter': 'Kerri (uncredited)'}, {'id': 'nm5652266', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Russell Hightower', 'asCharacter': 'Russ (uncredited)'}, {'id': 'nm2361932', 'image': 'https://m.media-amazon.com/images/M/MV5BODZjNTEwMzYtNmZmMS00YzRjLWI3OGItZmFlMDFkZmQyMDg0XkEyXkFqcGdeQXVyMjQwMDg0Ng@@._V1_Ratio1.0000_AL_.jpg', 'name': 'Derek Wayne Johnson', 'asCharacter': "Tourette's Group Leader (uncredited)"}, {'id': 'nm0457050', 'image': 'https://m.media-amazon.com/images/M/MV5BMzEwYzI3ZWQtODExNy00MDJmLWFmYjQtN2RiOGI1MjFhZjk1XkEyXkFqcGdeQXVyMzg4MjMyODY@._V1_Ratio0.7273_AL_.jpg', 'name': 'Patrick Kirton', 'asCharacter': 'Fourth Golfer (uncredited)'}, {'id': 'nm2484902', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Ryne Little', 'asCharacter': 'Fox (uncredited)'}, {'id': 'nm2356508', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Mike Martindale', 'asCharacter': 'Math Teacher (uncredited)'}, {'id': 'nm3206167', 'image': 'https://m.media-amazon.com/images/M/MV5BZjIwZGFiNjktZDQwYS00ZWZiLWJiOGQtNGJmNjUyZjRjNDNlXkEyXkFqcGdeQXVyMTMyNjUwMTA@._V1_Ratio1.5000_AL_.jpg', 'name': 'Jonathon McClendon', 'asCharacter': 'Bully #2 (uncredited)'}, {'id': 'nm3067474', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Lee Ann McDade', 'asCharacter': '2nd Grade Teacher (uncredited)'}, {'id': 'nm3165513', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Chase McDaniel', 'asCharacter': 'Bully (uncredited)'}, {'id': 'nm2946819', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'James B. McDaniel', 'asCharacter': "Tourette's Group Redhead (uncredited)"}, {'id': 'nm2378090', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Eric Kelly McFarland', 'asCharacter': 'Teacher (uncredited)'}, {'id': 'nm0606061', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Molly Moroney', 'asCharacter': "Tourette's Mother (uncredited)"}, {'id': 'nm2081926', 'image': 'https://m.media-amazon.com/images/M/MV5BOTU4MzE2NTc3OF5BMl5BanBnXkFtZTcwNzgyNDkzMQ@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Cameron Ten Napel', 'asCharacter': 'Caroline (uncredited)'}, {'id': 'nm2573717', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Halley Rachal', 'asCharacter': 'Award Ceremony Attendant (uncredited)'}, {'id': 'nm0783006', 'image': 'https://m.media-amazon.com/images/M/MV5BZTc4OTFiODgtN2I0Yi00YzBhLThlOTYtNWNlYzM1Yjk5OGU0XkEyXkFqcGdeQXVyMDUxMzAzNg@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Summer Selby', 'asCharacter': 'Third Principal (uncredited)'}, {'id': 'nm0809806', 'image': 'https://m.media-amazon.com/images/M/MV5BNDA0ODY1ZDQtYjBiYS00ZjdkLWI4NGEtZDc4MzY5MTAzMTIxXkEyXkFqcGdeQXVyMTAzOTUyMDU@._V1_Ratio0.7273_AL_.jpg', 'name': 'Ron Clinton Smith', 'asCharacter': 'Patrolman (uncredited)'}, {'id': 'nm2569163', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Molly Jane Sullivan', 'asCharacter': 'Molly (uncredited)'}, {'id': 'nm1751505', 'image': 'https://m.media-amazon.com/images/M/MV5BZmIwZGZkYmUtZDMwYi00ZTZhLWE0NWEtZmIwM2FiNjA4OTdmXkEyXkFqcGdeQXVyNDQ4NjM2Ng@@._V1_Ratio0.7273_AL_.jpg', 'name': 'Wendy Talley', 'asCharacter': 'Customer (uncredited)'}, {'id': 'nm3139442', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Clayton S. Taylor', 'asCharacter': 'Awards Banquet Attendee (uncredited)'}, {'id': 'nm0860689', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Sarah J. Thompson', 'asCharacter': 'Park Goer (uncredited)'}, {'id': 'nm1074400', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Philip Tracy', 'asCharacter': 'Second Golfer (uncredited)'}, {'id': 'nm7415857', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Rorie Vogel', 'asCharacter': 'Student (uncredited)'}, {'id': 'nm2837726', 'image': 'https://imdb-api.com/images/original/nopicture.jpg', 'name': 'Thomas Wallace', 'asCharacter': 'School Administrator (uncredited)'}, {'id': 'nm0931739', 'image': 'https://m.media-amazon.com/images/M/MV5BMTUyNjk5NjE0NF5BMl5BanBnXkFtZTcwMDczNTQzMQ@@._V1_Ratio1.3182_AL_.jpg', 'name': 'Steven E. Williams', 'asCharacter': 'School Supervisor / Background Driver (uncredited)'}], 'others': [{'job': 'Produced by', 'items': [{'id': 'nm8229810', 'name': 'Andrew Gottlieb', 'description': 'producer'}, {'id': 'nm0423682', 'name': 'Cameron Johann', 'description': 'co-producer'}, {'id': 'nm0793174', 'name': 'Brent Shields', 'description': 'executive producer'}, {'id': 'nm0795420', 'name': 'Tim Shriver', 'description': 'executive producer'}]}, {'job': 'Music by', 'items': [{'id': 'nm0873560', 'name': 'Ernest Troost', 'description': ''}]}, {'job': 'Cinematography by', 'items': [{'id': 'nm0254580', 'name': 'Paul Elliott', 'description': ''}]}, {'job': 'Film Editing by', 'items': [{'id': 'nm0064200', 'name': 'David Beatty', 'description': ''}]}, {'job': 'Production Design by', 'items': [{'id': 'nm0312152', 'name': 'James A. Gelarden', 'description': ''}]}, {'job': 'Art Direction by', 'items': [{'id': 'nm1732715', 'name': 'Christina Eunji Kim', 'description': ''}]}, {'job': 'Set Decoration by', 'items': [{'id': 'nm0424638', 'name': 'Bradford Johnson', 'description': ''}]}, {'job': 'Costume Design by', 'items': [{'id': 'nm0364672', 'name': 'Enid Harris', 'description': ''}]}, {'job': 'Makeup Department', 'items': [{'id': 'nm2722840', 'name': 'Jack Lazzaro', 'description': 'makeup artist'}, {'id': 'nm2308772', 'name': 'Courtney Lether', 'description': 'makeup department head'}, {'id': 'nm1733654', 'name': 'Chrissy Morris', 'description': 'key makeup artist'}, {'id': 'nm1417207', 'name': 'Tony Ward', 'description': 'hair stylist'}, {'id': 'nm1025204', 'name': 'Melizah Anguiano Wheat', 'description': 'department head hair (as Melizah Schmidt)'}, {'id': 'nm2510744', 'name': 'Crystal Woodford', 'description': 'key hair stylist'}]}, {'job': 'Production Management', 'items': [{'id': 'nm0280348', 'name': 'Pam Fitzgerald', 'description': 'post-production supervisor'}, {'id': 'nm0604558', 'name': 'Christopher Morgan', 'description': 'unit production manager'}]}, {'job': 'Second Unit Director or Assistant Director', 'items': [{'id': 'nm0041879', 'name': 'Scott August', 'description': 'second second assistant director'}, {'id': 'nm0375032', 'name': 'Michael Helfand', 'description': 'second assistant director (as Mike Helfand)'}]}, {'job': 'Art Department', 'items': [{'id': 'nm2939745', 'name': 'Cook Allender', 'description': 'on-set dresser'}, {'id': 'nm1822051', 'name': 'Aaron Boutte', 'description': 'art production assistant'}, {'id': 'nm0120830', 'name': 'Ed Burcham', 'description': 'set dresser (as Eddie Burcham)'}, {'id': 'nm2363447', 'name': 'Daniel Coe', 'description': 'construction coordinator'}, {'id': 'nm2750906', 'name': 'Matthew L. Crowson', 'description': 'painter'}, {'id': 'nm2502805', 'name': 'Mimi Gauthier', 'description': 'assistant set decorator'}, {'id': 'nm2424190', 'name': 'Chad Harris', 'description': 'set dresser'}, {'id': 'nm0376696', 'name': 'Michael Hendrick', 'description': 'leadman'}, {'id': 'nm2740993', 'name': 'Phillip Joffrion', 'description': 'set dresser'}, {'id': 'nm3830537', 'name': 'David Myers', 'description': 'painter'}, {'id': 'nm3079879', 'name': 'William Nutt', 'description': 'key greensman'}, {'id': 'nm2705254', 'name': 'Johnnie Ruth Richey', 'description': 'props production assistant'}, {'id': 'nm1070168', 'name': 'Michelle Rolland', 'description': 'property master'}, {'id': 'nm2776190', 'name': 'Sonda L. Rowland', 'description': 'painter'}, {'id': 'nm2802401', 'name': 'Corie Savary', 'description': 'assistant property master'}, {'id': 'nm2869617', 'name': 'Tim J. Smith', 'description': 'set dresser'}, {'id': 'nm14274061', 'name': 'Meaghan L. Stack', 'description': 'props production assistant'}, {'id': 'nm2844896', 'name': 'Jason Wilson', 'description': 'general foreman'}, {'id': 'nm2384797', 'name': 'Michael Wynn', 'description': 'painter'}]}, {'job': 'Sound Department', 'items': [{'id': 'nm0029498', 'name': 'Suzanne Angel', 'description': 'supervising adr editor'}, {'id': 'nm2617559', 'name': 'Joel D. Catalan', 'description': 'sound recordist (as Joel Catalan)'}, {'id': 'nm0157668', 'name': 'Tim Chilton', 'description': 'foley artist'}, {'id': 'nm3150873', 'name': 'Chris Gresham', 'description': 'voiceover mixer'}, {'id': 'nm2683084', 'name': 'Matt Hovland', 'description': 'sound recordist'}, {'id': 'nm0455225', 'name': 'Ron King', 'description': 'sound mixer'}, {'id': 'nm2811235', 'name': 'Verlie King', 'description': 'sound utility'}, {'id': 'nm0578288', 'name': 'Joe Melody', 'description': 'sound supervisor'}, {'id': 'nm0639900', 'name': "Terry O'Bright", 'description': 're-recording mixer'}, {'id': 'nm0734730', 'name': 'Keith Rogers', 'description': 're-recording mixer'}, {'id': 'nm0868605', 'name': 'David Torres', 'description': 'foley mixer'}, {'id': 'nm2348814', 'name': 'Carlos Wilkerson', 'description': 'boom operator'}]}, {'job': 'Special Effects by', 'items': [{'id': 'nm0528320', 'name': 'Jack Lynch', 'description': 'special effects coordinator'}]}, {'job': 'Visual Effects by', 'items': [{'id': 'nm0047460', 'name': 'Robert D. Bailey', 'description': 'visual effects supervisor'}, {'id': 'nm0383613', 'name': 'O.T. Hight', 'description': 'visual effects artist'}, {'id': 'nm2334539', 'name': 'Kevin Stevenson', 'description': 'computer graphics artist'}]}, {'job': 'Stunts', 'items': [{'id': 'nm0311470', 'name': 'Lex D. Geddings', 'description': 'stunt coordinator'}, {'id': 'nm3326691', 'name': 'Dawson Towery', 'description': 'stunt player'}, {'id': 'nm0869961', 'name': 'Russell Towery', 'description': 'stunt player'}, {'id': 'nm0322014', 'name': 'Tom Glass', 'description': 'truck stunts (uncredited)'}, {'id': 'nm3331312', 'name': 'Mark Yawn', 'description': 'precision driver (uncredited)'}]}, {'job': 'Camera and Electrical Department', 'items': [{'id': 'nm2692050', 'name': 'Tarik Naim Alherimi', 'description': 'best boy electric'}, {'id': 'nm0050450', 'name': 'Richard Ball', 'description': 'key grip'}, {'id': 'nm2764248', 'name': 'Jayson S. Coddington', 'description': 'grip'}, {'id': 'nm2641381', 'name': 'Duane Cooper', 'description': 'key rigging grip'}, {'id': 'nm2666486', 'name': 'Sean Cruz', 'description': 'set lighting technician'}, {'id': 'nm0217713', 'name': 'Bryan DeLorenzo', 'description': 'second assistant "b" camera'}, {'id': 'nm1691412', 'name': 'Steve Dietl', 'description': 'still photographer'}, {'id': 'nm3151978', 'name': 'John Gregory Edwards', 'description': 'electrician'}, {'id': 'nm1744482', 'name': 'Kevin Gazdik', 'description': 'key rigging gaffer'}, {'id': 'nm4718662', 'name': 'Kevin Lippincott', 'description': 'electrician'}, {'id': 'nm0614428', 'name': 'Keith Murphy', 'description': 'camera operator / steadicam operator'}, {'id': 'nm2958675', 'name': 'Adrian Neri', 'description': 'b dolly'}, {'id': 'nm0646450', 'name': 'Paul Olinde', 'description': 'gaffer'}, {'id': 'nm1459738', 'name': 'Robert Owen', 'description': 'lighting technician'}, {'id': 'nm0827254', 'name': 'George Stephenson', 'description': 'camera operator: "a" camera'}, {'id': 'nm2334539', 'name': 'Kevin Stevenson', 'description': 'video playback'}, {'id': 'nm0906575', 'name': 'Joe Waistell', 'description': 'first assistant camera: "a" camera'}]}, {'job': 'Casting Department', 'items': [{'id': 'nm1768992', 'name': 'Andrei Constantinescu', 'description': 'extras casting'}, {'id': 'nm0003630', 'name': 'Ryan Glorioso', 'description': 'extras casting'}, {'id': 'nm0341360', 'name': 'Shay Griffin', 'description': 'casting: Atlanta'}, {'id': 'nm0519804', 'name': 'Molly Lopata', 'description': 'casting'}, {'id': 'nm0823868', 'name': 'Tommy Staub', 'description': 'casting: Louisiana'}, {'id': 'nm2840785', 'name': 'Kate Warren', 'description': 'extras casting coordinator'}]}, {'job': 'Costume and Wardrobe Department', 'items': [{'id': 'nm2893237', 'name': 'Andrée Fortier', 'description': 'costumer (as Andree Fortier)'}, {'id': 'nm2825928', 'name': 'Gayle Merindino', 'description': 'set costumer (as Gayle Anderson)'}, {'id': 'nm2893269', 'name': 'Jane Ryder', 'description': 'seamstress'}, {'id': 'nm2993125', 'name': 'Rodney Williamson', 'description': 'assistant costume designer'}]}, {'job': 'Editorial Department', 'items': [{'id': 'nm0253161', 'name': 'Fred Eldridge', 'description': 'senior colorist'}, {'id': 'nm0940641', 'name': 'Z. Jean Woods', 'description': 'assistant editor'}, {'id': 'nm2701979', 'name': 'Joshua Alan Baca', 'description': 'on-line editor (uncredited)'}]}, {'job': 'Location Management', 'items': [{'id': 'nm2189783', 'name': 'Christina DeCharles', 'description': 'location scout'}, {'id': 'nm3424390', 'name': 'David P Hebert', 'description': 'assistant location manager'}, {'id': 'nm1170907', 'name': 'Kendrick Hudson', 'description': 'assistant location manager'}, {'id': 'nm0669161', 'name': 'F. Stanley Pearse Jr.', 'description': 'location manager'}, {'id': 'nm3376264', 'name': 'Tara N. Talley-Brown', 'description': 'location assistant (as Tara T. Miller)'}]}, {'job': 'Music Department', 'items': [{'id': 'nm0496536', 'name': 'Chris Ledesma', 'description': 'music editor'}, {'id': 'nm0562479', 'name': 'Miriam Mayer', 'description': 'violin and viola'}, {'id': 'nm0002850', 'name': 'Rick Giovinazzo', 'description': 'orchestrator (uncredited)'}, {'id': 'nm1395391', 'name': 'Andrea von Foerster', 'description': 'music supervisor (uncredited)'}]}, {'job': 'Script and Continuity Department', 'items': [{'id': 'nm0837941', 'name': 'Sam Sullivan', 'description': 'script supervisor (as Samuel W. Sullivan)'}]}, {'job': 'Transportation Department', 'items': [{'id': 'nm2416680', 'name': 'Dennis W. Cook Jr.', 'description': 'picture car coordinator'}, {'id': 'nm2842480', 'name': 'Gerald Hardy', 'description': 'driver'}, {'id': 'nm0483361', 'name': 'A. Welch Lambeth', 'description': 'transportation coordinator (as Welch Lambeth)'}, {'id': 'nm2741192', 'name': 'Buddy Pine', 'description': 'driver: honeywagon'}, {'id': 'nm0808928', 'name': 'Ken Smith', 'description': 'transportation coordinator'}, {'id': 'nm1557483', 'name': 'Charlie Wright', 'description': 'transportation captain'}, {'id': 'nm2484636', 'name': 'Felicia Zamora', 'description': 'driver'}, {'id': 'nm1745912', 'name': 'Christy Zeller', 'description': 'transportation office coordinator'}, {'id': 'nm1104388', 'name': 'Russell Hicks', 'description': 'production van driver operator (uncredited)'}, {'id': 'nm0933077', 'name': 'Doug Wilson', 'description': 'driver (uncredited)'}]}, {'job': 'Additional Crew', 'items': [{'id': 'nm3226633', 'name': 'Adam Askew', 'description': 'production assistant'}, {'id': 'nm3000384', 'name': 'Barbara Babb', 'description': 'set production assistant'}, {'id': 'nm3109524', 'name': 'Will Barron', 'description': 'stand-in: Mr. Wolk'}, {'id': 'nm2705506', 'name': 'Victoria Carnall', 'description': 'payroll accountant'}, {'id': 'nm2641594', 'name': 'Brooke Coleman', 'description': 'assistant to director'}, {'id': 'nm3079656', 'name': 'Diane Davis', 'description': 'set medic'}, {'id': 'nm1809276', 'name': 'Mike De La Vina', 'description': 'key set production assistant'}, {'id': 'nm3292411', 'name': 'Danielle Fischer', 'description': 'second assistant accountant (as Danielle Trejo)'}, {'id': 'nm2852451', 'name': 'Charles Gibson', 'description': 'production secretary'}, {'id': 'nm3228329', 'name': 'Rachael Hansil', 'description': 'production assistant (as Rachael DeSoto)'}, {'id': 'nm3099300', 'name': 'Krystal Mayo', 'description': 'stand-in'}, {'id': 'nm0568056', 'name': 'Mary McDonald-Lewis', 'description': 'dialect coach'}, {'id': 'nm2110602', 'name': 'Shannon Parker', 'description': 'basecamp p.a.'}, {'id': 'nm0691206', 'name': 'Jacqui Popelka', 'description': 'production coordinator'}, {'id': 'nm2210869', 'name': 'Greg Washington', 'description': 'set medic'}, {'id': 'nm0932536', 'name': 'Scott Willmann', 'description': 'production accountant'}, {'id': 'nm4626892', 'name': 'Daryl Wilsford', 'description': 'second assistant accountant'}, {'id': 'nm2085553', 'name': 'Debra Woods Kaufmann', 'description': 'assistant production coordinator'}, {'id': 'nm2831141', 'name': 'Jeannie Perrin', 'description': 'stand-in (uncredited)'}]}], 'errorMessage': ''}
        writers = [self._select_fields(w, ['id', 'name']) for w in response_json['writers']['items']]
        actors = [self._select_fields(w, ['id', 'name']) for w in response_json['actors']]
        df_act = pd.DataFrame(actors)
        df_write = pd.DataFrame(writers)
        df_act['movie_id'] = id
        df_write['movie_id'] = id
        return df_write, df_act

    def _add_writers_and_actors(self, movies: List[dict]):
        dfs_list = []
        for m in movies['id'].tolist():
            dfs_list.append(self._get_full_cast_for_id(m))

        df_write = pd.concat([df[0] for df in dfs_list])
        df_act = pd.concat([df[1] for df in dfs_list])
        return df_write, df_act

    def get_movies(self, title_type, user_rating, release_date, num_votes, count):
        # movies = self._advanced_search(title_type, user_rating, release_date, num_votes, count)
        movies = [{'id': 'tt1292594', 'title': 'Front of the Class', 'description': '(2008 TV Movie)', 'imDbRating': '8.0', 'imDbRatingVotes': '7578', 'stars': 'Peter Werner, James Wolk, Treat Williams, Dominic Scott Kay, Sarah Drew', 'genres': 'Biography, Drama'}, {'id': 'tt0406046', 'title': 'The Magic of Ordinary Days', 'description': '(2005 TV Movie)', 'imDbRating': '7.5', 'imDbRatingVotes': '5135', 'stars': 'Brent Shields, Keri Russell, Skeet Ulrich, Mare Winningham, Tania Gunadi', 'genres': 'Drama'}]

        return pd.DataFrame(movies)
        # return {"id": "tt1292594", "title": "Front of the Class", "description": "(2008 TV Movie)", "imDbRating": "8.0", "imDbRatingVotes": "7576", "stars": "Peter Werner, James Wolk, Treat Williams, Dominic Scott Kay, Sarah Drew", "genres": "Biography, Drama", "writers": [{"id": "nm0725564", "name": "Thomas Rickman"}, {"id": "nm3222550", "name": "Brad Cohen"}, {"id": "nm3222441", "name": "Lisa Wysocky"}], "actors": [{"id": "nm2312345", "name": "James Wolk"}, {"id": "nm0001852", "name": "Treat Williams"}, {"id": "nm1122614", "name": "Dominic Scott Kay"}, {"id": "nm0237711", "name": "Sarah Drew"}, {"id": "nm0948723", "name": "Kathleen York"}, {"id": "nm0159609", "name": "Joe Chrest"}, {"id": "nm0005004", "name": "Patricia Heaton"}, {"id": "nm1067251", "name": "Johnny Pacar"}, {"id": "nm2628285", "name": "Charles Henry Wyson"}, {"id": "nm0278096", "name": "Charlie Finn"}, {"id": "nm0124894", "name": "Dianne Butler"}, {"id": "nm1641231", "name": "Helen Ingebritsen"}, {"id": "nm0926683", "name": "Laura Whyte"}, {"id": "nm0687772", "name": "Mike Pniewski"}, {"id": "nm2360398", "name": "Michael H. Cole"}, {"id": "nm3164835", "name": "Katherine Shepler"}, {"id": "nm3204360", "name": "Bryce Wilkins"}, {"id": "nm3385458", "name": "Zack Miller"}, {"id": "nm3147385", "name": "Anna Rappaport"}, {"id": "nm2677066", "name": "Nicholas Stargel"}, {"id": "nm2264463", "name": "Connor Hill"}, {"id": "nm0079925", "name": "Karen Beyer"}, {"id": "nm0480808", "name": "Sandra Ellis Lafferty"}, {"id": "nm0249281", "name": "Lori Beth Sikes"}, {"id": "nm0718680", "name": "Ric Reitz"}, {"id": "nm0096303", "name": "Matt Borel"}, {"id": "nm3153028", "name": "Chan Ta Rivers"}, {"id": "nm2054268", "name": "Jenny Shakeshaft"}, {"id": "nm0414865", "name": "Jill Jacobson"}, {"id": "nm4955327", "name": "Ransom Ashley"}, {"id": "nm2591390", "name": "Breanna Brooks"}, {"id": "nm3261114", "name": "NyaSimone Caldwell"}, {"id": "nm7764516", "name": "M Charlotte Cheatham"}, {"id": "nm2641594", "name": "Brooke Coleman"}, {"id": "nm0178385", "name": "Silas Cooper"}, {"id": "nm0187603", "name": "Tommy Cresswell"}, {"id": "nm3161484", "name": "Ella Davidson"}, {"id": "nm4237669", "name": "Tavaris James Durell"}, {"id": "nm2467078", "name": "Ted Ferguson"}, {"id": "nm3586837", "name": "Juanita Harrison"}, {"id": "nm1892325", "name": "Halen D. Isbell"}, {"id": "nm3109068", "name": "Avery Kelley"}, {"id": "nm3218666", "name": "Tyler Krieg"}, {"id": "nm3218782", "name": "Jayden Mankins"}, {"id": "nm8654082", "name": "Desiree Page"}, {"id": "nm1296340", "name": "Terry Dale Parks"}, {"id": "nm4472415", "name": "James Paul"}, {"id": "nm2831141", "name": "Jeannie Perrin"}, {"id": "nm3237481", "name": "Shelby Purchner"}, {"id": "nm12896193", "name": "Krystyn Ryder"}, {"id": "nm0821436", "name": "Andy Stahl"}, {"id": "nm3769920", "name": "Marchello Stewart"}, {"id": "nm4740539", "name": "Jeffrey Stirl"}, {"id": "nm0840285", "name": "Carol Sutton"}, {"id": "nm2772185", "name": "Lanie Taylor"}, {"id": "nm3644821", "name": "David Lee Valle"}, {"id": "nm2397206", "name": "Jake Austin Walker"}, {"id": "nm3110746", "name": "Scott Yarnell"}, {"id": "nm1874504", "name": "Mark Adam"}, {"id": "nm3400248", "name": "Ryan Akin"}, {"id": "nm0093135", "name": "Angie Bolling"}, {"id": "nm2720564", "name": "Bruce Bryant"}, {"id": "nm2732159", "name": "Michael Byrnes"}, {"id": "nm2326027", "name": "Renee Caldwell"}, {"id": "nm3160743", "name": "Cole Cordell"}, {"id": "nm2468237", "name": "Kip Cummings"}, {"id": "nm3271029", "name": "Jon Dainty"}, {"id": "nm0272393", "name": "Chamblee Ferguson"}, {"id": "nm3180150", "name": "Kerrigan Hightower"}, {"id": "nm5652266", "name": "Russell Hightower"}, {"id": "nm2361932", "name": "Derek Wayne Johnson"}, {"id": "nm0457050", "name": "Patrick Kirton"}, {"id": "nm2484902", "name": "Ryne Little"}, {"id": "nm2356508", "name": "Mike Martindale"}, {"id": "nm3206167", "name": "Jonathon McClendon"}, {"id": "nm3067474", "name": "Lee Ann McDade"}, {"id": "nm3165513", "name": "Chase McDaniel"}, {"id": "nm2946819", "name": "James B. McDaniel"}, {"id": "nm2378090", "name": "Eric Kelly McFarland"}, {"id": "nm0606061", "name": "Molly Moroney"}, {"id": "nm2081926", "name": "Cameron Ten Napel"}, {"id": "nm2573717", "name": "Halley Rachal"}, {"id": "nm0783006", "name": "Summer Selby"}, {"id": "nm0809806", "name": "Ron Clinton Smith"}, {"id": "nm2569163", "name": "Molly Jane Sullivan"}, {"id": "nm1751505", "name": "Wendy Talley"}, {"id": "nm3139442", "name": "Clayton S. Taylor"}, {"id": "nm0860689", "name": "Sarah J. Thompson"}, {"id": "nm1074400", "name": "Philip Tracy"}, {"id": "nm7415857", "name": "Rorie Vogel"}, {"id": "nm2837726", "name": "Thomas Wallace"}, {"id": "nm0931739", "name": "Steven E. Williams"}]}, {"id": "tt0406046", "title": "The Magic of Ordinary Days", "description": "(2005 TV Movie)", "imDbRating": "7.5", "imDbRatingVotes": "5131", "stars": "Brent Shields, Keri Russell, Skeet Ulrich, Mare Winningham, Tania Gunadi", "genres": "Drama", "writers": [{"id": "nm1720853", "name": "Ann Howard Creel"}, {"id": "nm0859742", "name": "Camille Thomasson"}], "actors": [{"id": "nm0005392", "name": "Keri Russell"}, {"id": "nm0000240", "name": "Skeet Ulrich"}, {"id": "nm0001858", "name": "Mare Winningham"}, {"id": "nm1040208", "name": "Tania Gunadi"}, {"id": "nm1290102", "name": "Gwendoline Yeo"}, {"id": "nm0833063", "name": "Stephen Strachan"}, {"id": "nm1726563", "name": "Katie Keating"}, {"id": "nm0688285", "name": "Ken Pogue"}, {"id": "nm0935721", "name": "Eric Winter"}, {"id": "nm0569990", "name": "Jane McGregor"}, {"id": "nm0796036", "name": "Daryl Shuttleworth"}, {"id": "nm1736158", "name": "Brayden Bullen"}, {"id": "nm0245785", "name": "Sam Dyer"}, {"id": "nm0085420", "name": "Mary Black"}, {"id": "nm0730362", "name": "Jacqueline Robbins"}, {"id": "nm0730391", "name": "Joyce Robbins"}, {"id": "nm0744901", "name": "Karl Roth"}, {"id": "nm0559193", "name": "Andy Maton"}, {"id": "nm0368157", "name": "Roger Haskett"}, {"id": "nm1249771", "name": "Kira Bradley"}, {"id": "nm1059824", "name": "Tom Carey"}, {"id": "nm8373299", "name": "Skyler Banman"}, {"id": "nm3112113", "name": "Madison Lindstrom"}, {"id": "nm3570663", "name": "Calvin Vollrath"}]}


    def upload_movies_to_s3(self, title_type, user_rating, release_date, num_votes,
                            count, bucket_name='imdb-movies'):
        movies = self.get_movies(title_type, user_rating, release_date, num_votes, count)
        writers, actors = self._add_writers_and_actors(movies)
        write_data_to_s3(df=movies, bucket=bucket_name, key=f"movies_and_cast/movies.parquet")
        write_data_to_s3(df=writers, bucket=bucket_name, key=f"movies_and_cast/writers.parquet")
        write_data_to_s3(df=actors, bucket=bucket_name, key=f"movies_and_cast/actors.parquet")



if __name__ == "__main__":
    url = "https://imdb-api.com/API/AdvancedSearch/k_f3mxqolc?" \
          "title_type=tv_movie&user_rating=7.5,10&" \
          "release_date=1990-01-01,2023-01-01&" \
          "num_votes>10000&count=2500"


    imdb_api = ImdbApi()
    # imdb_api._get_full_cast_for_id('tt1375666')
    imdb_api.upload_movies_to_s3('tv_movie', '7.5,10', '1990-01-01,2023-01-01', '10000', '2')
